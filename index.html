<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Listar Produtos - Paginação</title>
</head>
<body>
  <h1>Lista de Produtos (Paginação)</h1>
  
  <!-- Botões e área de resultados -->
  <button id="btnCarregar">Carregar Página</button>
  <button id="btnAnterior">Anterior</button>
  <button id="btnProxima">Próxima</button>

  <div id="info"></div>
  <div id="lista"></div>
  
  <script>
    let paginaAtual = 1;
    let totalPaginas = 1;

    const infoEl = document.getElementById("info");
    const listaEl = document.getElementById("lista");

    const btnCarregar = document.getElementById("btnCarregar");
    const btnAnterior = document.getElementById("btnAnterior");
    const btnProxima = document.getElementById("btnProxima");

    btnCarregar.addEventListener("click", () => {
      paginaAtual = 1;
      carregarPagina(paginaAtual);
    });

    btnAnterior.addEventListener("click", () => {
      if (paginaAtual > 1) {
        paginaAtual--;
        carregarPagina(paginaAtual);
      }
    });

    btnProxima.addEventListener("click", () => {
      if (paginaAtual < totalPaginas) {
        paginaAtual++;
        carregarPagina(paginaAtual);
      }
    });

    async function carregarPagina(pagina) {
      infoEl.textContent = `Carregando página ${pagina}...`;
      listaEl.innerHTML = "";
      try {
        const resp = await fetch(`/.netlify/functions/listarProdutosPaginado?pagina=${pagina}`);
        if (!resp.ok) {
          throw new Error("Erro ao chamar a função serverless");
        }
        const data = await resp.json();
        
        // A API Omie normalmente retorna algo como:
        // {
        //   "pagina": 1,
        //   "total_de_paginas": 10,
        //   "registros": 50,
        //   "total_de_registros": 500,
        //   "produto_servico_cadastro": [ ... ]
        // }
        paginaAtual = data.pagina;
        totalPaginas = data.total_de_paginas;

        const produtos = data.produto_servico_cadastro || [];
        if (produtos.length === 0) {
          infoEl.textContent = "Nenhum produto encontrado para essa página.";
          return;
        }

        infoEl.textContent = `Página ${data.pagina} de ${data.total_de_paginas} | ${data.total_de_registros} produtos no total.`;

        // Montar HTML dos itens
        const itensHtml = produtos.map((item) => {
          // Exemplo: mostrando apenas "codigo" e "descricao"
          const codigo = item.codigo || "";
          const descricao = item.descricao || "";
          return `<li><strong>${codigo}</strong> - ${descricao}</li>`;
        }).join("");

        listaEl.innerHTML = `<ul>${itensHtml}</ul>`;
      } catch (err) {
        infoEl.textContent = "Erro: " + err.message;
      }
    }
  </script>
</body>
</html>
